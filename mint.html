<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mint — Based_d Babes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Ethers v6 -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.10.0/dist/ethers.umd.min.js"></script>

  <style>
    body {
      background: #0b0b0b;
      color: #f5f5f5;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      text-align: center;
      padding: 3rem 1rem;
    }
    h1 { font-weight: 600; }
    button {
      background: #fff;
      color: #000;
      border: none;
      padding: 1rem 2rem;
      font-size: 1rem;
      cursor: pointer;
      margin-top: 1rem;
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .status {
      margin-top: 1.5rem;
      font-size: 0.95rem;
      line-height: 1.4;
    }
    .error { color: #ff6b6b; }
    .success { color: #6bff95; }
    .tx-link { color: #7aa2ff; text-decoration: none; }
  </style>
</head>

<body>

<h1>Based_d Babes — The Archetypes</h1>
<p>Archetype #001: The Steward</p>

<button id="connectBtn">Connect Wallet</button><br />
<button id="mintBtn" disabled>Mint (0.003 ETH)</button>

<div id="status" class="status"></div>

<script>
/* ============================================================
   CANONICAL CONFIG (LOCKED)
   ============================================================ */

const BASE_CHAIN_ID = 8453;

const COLLECTION_ADDRESS = "0x5dCFeD9D2897d9EA587a30EcDA5a069461Ca46Dd";
const ZORA_FIXED_PRICE_MINTER = "0x04E2516A2c207E84a1839755675dfd8eF6302F0a";

const TOKEN_ID = 1;
const PRICE_PER_TOKEN = "0.003";
const QUANTITY = 1;

/* ============================================================
   STATE
   ============================================================ */

let provider;
let signer;
let walletAddress;

/* ============================================================
   UI HELPERS
   ============================================================ */

const statusEl = document.getElementById("status");
const connectBtn = document.getElementById("connectBtn");
const mintBtn = document.getElementById("mintBtn");

function setStatus(msg, type = "") {
  statusEl.className = `status ${type}`;
  statusEl.innerHTML = msg;
}

/* ============================================================
   NETWORK GUARD
   ============================================================ */

async function ensureBase() {
  const network = await provider.getNetwork();
  if (Number(network.chainId) !== BASE_CHAIN_ID) {
    throw new Error("Please switch to Base mainnet.");
  }
}

/* ============================================================
   WALLET CONNECT
   ============================================================ */

connectBtn.onclick = async () => {
  try {
    if (!window.ethereum) throw new Error("No wallet detected.");

    provider = new ethers.BrowserProvider(window.ethereum);
    await provider.send("eth_requestAccounts", []);
    signer = await provider.getSigner();
    walletAddress = await signer.getAddress();

    await ensureBase();

    connectBtn.textContent = "Wallet Connected";
    connectBtn.disabled = true;
    mintBtn.disabled = false;

    setStatus(
      `Connected: ${walletAddress.slice(0,6)}…${walletAddress.slice(-4)}`,
      "success"
    );
  } catch (err) {
    setStatus(err.message, "error");
  }
};

/* ============================================================
   ZORA FIXED PRICE SALE MINT
   ============================================================ */

mintBtn.onclick = async () => {
  mintBtn.disabled = true;
  mintBtn.textContent = "Minting…";

  try {
    await ensureBase();

    const zoraMinterAbi = [
      "function mint(uint256 quantity, address collection, uint256 tokenId, address recipient, address mintReferral) payable"
    ];

    const minter = new ethers.Contract(
      ZORA_FIXED_PRICE_MINTER,
      zoraMinterAbi,
      signer
    );

    const tx = await minter.mint(
      QUANTITY,
      COLLECTION_ADDRESS,
      TOKEN_ID,
      walletAddress,
      ethers.ZeroAddress,
      {
        value: ethers.parseEther(PRICE_PER_TOKEN)
      }
    );

    setStatus(
      `Transaction sent.<br>
       <a class="tx-link" href="https://basescan.org/tx/${tx.hash}" target="_blank">
         View on BaseScan →
       </a>`,
      "success"
    );

    await tx.wait();

    setStatus("Mint confirmed on-chain.", "success");

  } catch (err) {
    console.error(err);
    setStatus(err.shortMessage || err.reason || err.message, "error");
  } finally {
    mintBtn.disabled = false;
    mintBtn.textContent = "Mint (0.003 ETH)";
  }
};
</script>

</body>
</html>
